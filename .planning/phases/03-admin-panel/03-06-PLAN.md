---
phase: 03-admin-panel
plan: 06
type: execute
wave: 6
depends_on: [1, 2, 3, 4, 5]
files_modified:
  - "app/admin/dashboard/page.tsx"
  - "components/ui/skeleton.tsx"
  - "components/ui/alert.tsx"
  - "components/error-boundary.tsx"
  - "middleware.ts"
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Dashboard provides overview of documents, conversations, and widget usage"
    - "All admin pages have consistent loading states and error handling"
    - "Admin panel is fully accessible and mobile responsive"
    - "All admin features work together seamlessly"
  artifacts:
    - path: "app/admin/dashboard/page.tsx"
      provides: "Dashboard overview with stats cards and quick actions"
      min_lines: 80
    - path: "components/ui/skeleton.tsx"
      provides: "Reusable skeleton loading component"
      min_lines: 30
    - path: "components/ui/alert.tsx"
      provides: "Alert component for error states"
      min_lines: 30
    - path: "components/error-boundary.tsx"
      provides: "React Error Boundary for graceful error handling"
      min_lines: 40
  key_links:
    - from: "app/admin/dashboard/page.tsx"
      to: "/api/rag/documents"
      via: "Fetch document count"
      pattern: "count.*documents"
    - from: "app/admin/dashboard/page.tsx"
      to: "/api/conversations"
      via: "Fetch conversation count"
      pattern: "count.*conversations"
    - from: "components/error-boundary.tsx"
      to: "app/admin/*/page.tsx"
      via: "Wrap all admin pages for error isolation"
      pattern: "ErrorBoundary.*children"

provides_interface:
  - name: DashboardOverviewService
    type: service
    methods: [getDocumentCount, getConversationCount, getRecentActivity]
    description: Aggregate statistics for admin dashboard

assumes_from:
  - phase: 1
    interface: AdminAuthService
    usage: Protected dashboard access
  - phase: 2
    interface: DocumentService
    usage: Document count for dashboard stats
  - phase: 3
    interface: ConversationHistoryService
    usage: Conversation count for dashboard stats
---

<objective>
Finalize admin panel with dashboard overview, polish user experience, and comprehensive verification.

Purpose: Completes the admin panel with dashboard statistics, ensures consistent UX across all pages, and verifies all ADMIN requirements are met.
Output: Dashboard page with stats, loading states, error boundaries, mobile responsiveness, and final verification.
</objective>

<execution_context>
{file:~/.config/opencode/gsd/workflows/execute-plan.md}
{file:~/.config/opencode/gsd/templates/summary.md}
</execution_context>

<context>
@.planning/phases/03-admin-panel/03-01-PLAN.md
@.planning/phases/03-admin-panel/03-02-PLAN.md
@.planning/phases/03-admin-panel/03-03-PLAN.md
@.planning/phases/03-admin-panel/03-04-PLAN.md
@.planning/phases/03-admin-panel/03-05-PLAN.md
@.planning/phases/03-admin-panel/03-RESEARCH.md

# All admin features implemented in previous plans:
# - ADMIN-01: Sources Management (Plan 02)
# - ADMIN-02: Conversations View (Plan 03)
# - ADMIN-03: Widget Customization (Plan 04)
# - ADMIN-04: Embed Code Generation (Plan 05)
</context>

<tasks>

<task type="auto">
  <name>Create dashboard overview page</name>
  <files>app/admin/dashboard/page.tsx</files>
  <action>
    Build admin dashboard with statistics and quick actions:

    - Create app/admin/dashboard/page.tsx as Server Component
    - Fetch aggregate statistics:
      - Total documents count
      - Total conversations count
      - Messages this week
      - API usage (if available)
    - Display stats in Card components:
      - Use CardHeader, CardTitle, CardContent
      - Add icons for visual distinction
      - Show trend indicators if possible
    - Add "Quick Actions" section:
      - "Add New Document" link to /admin/sources/new
      - "View Conversations" link to /admin/conversations
      - "Customize Widget" link to /admin/settings
      - "Get Embed Code" link to /admin/embed
    - Add "Recent Activity" section:
      - List most recent documents added
      - List most recent conversations
    - Add "At a Glance" metrics:
      - Documents by status (processing/ready/failed)
      - Conversations today/this week
    - Style with consistent admin panel design
    
    Reference: RESEARCH.md section "Admin Panel Page Structure" (dashboard section).
  </action>
  <verify>
    - Read app/admin/dashboard/page.tsx
    - Verify 4 stat cards with counts
    - Check quick actions section
    - Verify links to all admin sections
  </verify>
  <done>
    Dashboard provides overview and quick navigation
  </done>
</task>

<task type="auto">
  <name>Create skeleton loading components</name>
  <files>components/ui/skeleton.tsx</files>
  <action>
    Build reusable skeleton components for loading states:

    - Create components/ui/skeleton.tsx
    - Implement Skeleton component using Tailwind's animate-pulse:
      - Basic skeleton rectangle
      - Skeleton circle for avatars
      - Skeleton text lines
    - Create SkeletonCard for DataTable loading:
      - Header row skeleton
      - Multiple row skeletons
    - Create SkeletonForm for form loading:
      - Label skeleton
      - Input skeleton
      - Button skeleton
    - Use in all admin pages:
      - Sources page: skeleton for document rows
      - Conversations page: skeleton for conversation rows
      - Settings page: skeleton for form fields
      - Embed page: skeleton for embed code
    - Import and use in Client Components with isLoading state
    
    Reference: RESEARCH.md "Common Pitfalls" section (blocking UI during loading).
  </action>
  <verify>
    - Read components/ui/skeleton.tsx
    - Verify Skeleton component with animate-pulse
    - Check SkeletonCard for table loading
    - Verify usage in admin pages
  </verify>
  <done>
    All admin pages have loading states
  </done>
</task>

<task type="auto">
  <name>Create alert and error boundary components</name>
  <files>components/ui/alert.tsx, components/error-boundary.tsx</files>
  <action>
    Build error handling components:

    - Create components/ui/alert.tsx:
      - Alert component with variants (error, warning, info, success)
      - AlertTitle for heading
      - AlertDescription for message
      - Use for error displays across admin panel

    - Create components/error-boundary.tsx:
      - React ErrorBoundary using getDerivedStateFromError
      - FallbackUI function to display error
      - Error message with stack trace in development
      - "Try again" button to reload page
      - Wrap all admin pages with ErrorBoundary
      - Log errors for debugging

    - Implement error handling in admin pages:
      - Sources page: Show alert if documents fail to load
      - Conversations page: Show alert if API error
      - Settings page: Show alert if save fails
      - Embed page: Show alert if key generation fails
    
    Reference: RESEARCH.md "Common Pitfalls" section.
  </action>
  <verify>
    - Read components/ui/alert.tsx
    - Verify Alert component with variants
    - Read components/error-boundary.tsx
    - Check ErrorBoundary implementation
    - Verify ErrorBoundary wraps admin pages
  </verify>
  <done>
    Graceful error handling across admin panel
  </done>
</task>

<task type="auto">
  <name>Implement mobile responsiveness verification</name>
  <files>app/admin/layout.tsx, app/admin/*/page.tsx</files>
  <action>
    Ensure all admin pages are mobile responsive:

    - Test and fix sidebar on mobile:
      - Add SidebarTrigger button in header
      - Verify sidebar collapses on mobile
      - Test touch interactions
    - Verify DataTable responsiveness:
      - Add horizontal scroll for tables on small screens
      - Make actions dropdown accessible on mobile
      - Add touch-friendly tap targets
    - Fix form layouts on mobile:
      - Single column layout (already implemented)
      - Adequate spacing for touch
      - Input fields large enough for touch
    - Test dashboard on mobile:
      - Stack stat cards vertically
      - Make quick action buttons large enough
    - Test conversation thread on mobile:
      - Message bubbles resize properly
      - Sources citations wrap correctly
    - Test widget preview on mobile:
      - Show mobile-sized preview option
      - Verify position toggle works for mobile
    
    Reference: RESEARCH.md "Common Pitfalls" section (responsive design).
  </action>
  <verify>
    - Test sidebar toggle on mobile viewport
    - Verify DataTable horizontal scroll
    - Check form fields on mobile
    - Test conversation thread on mobile
    - Verify widget preview on mobile
  </verify>
  <done>
    Admin panel works well on mobile devices
  </done>
</task>

<task type="auto">
  <name>Add toast notifications throughout</name>
  <files>app/admin/*/page.tsx</files>
  <action>
    Implement consistent toast notifications:

    - Import toast from sonner (Shadcn/ui)
    - Add success toasts for:
      - Document added successfully
      - Document deleted successfully
      - Settings saved successfully
      - API key regenerated
      - Embed code copied
    - Add error toasts for:
      - Document upload failed
      - Delete failed
      - Save failed
      - API error
    - Position toasts in consistent location (top-right)
    - Add auto-dismiss timeout (5 seconds)
    - Include action buttons for retry where applicable
    - Use in all admin pages for consistency
    
    Reference: RESEARCH.md section "Toast notifications" in standard stack.
  </action>
  <verify>
    - Check success toasts work on document operations
    - Verify error toasts display on failures
    - Test toast auto-dismiss
    - Check toast positioning
  </verify>
  <done>
    Consistent feedback via toasts throughout admin panel
  </done>
</task>

<task type="auto">
  <name>Verify accessibility compliance</name>
  <files>app/admin/*/page.tsx, components/*</files>
  <action>
    Ensure accessibility across admin panel:

    - Keyboard navigation:
      - All interactive elements focusable
      - Tab order follows logical flow
      - Skip to main content link
    - ARIA attributes:
      - Labels on all form inputs
      - Aria-describedby for errors
      - Aria-live for dynamic content
      - Role attributes for non-semantic elements
    - Color contrast:
      - Text meets WCAG AA contrast ratios
      - Status badges have sufficient contrast
      - Error states clearly visible
    - Screen reader support:
      - Alt text on all images
      - Aria labels on icons
      - Descriptive page titles
      - Table headers marked correctly
    - Form accessibility:
      - Required fields marked
      - Error messages linked to inputs
      - Instructions provided
    - Test with axe DevTools or similar
    
    Reference: Shadcn/ui accessibility patterns and WCAG guidelines.
  </action>
  <verify>
    - Test keyboard navigation through all admin pages
    - Check color contrast ratios
    - Verify ARIA attributes present
    - Test with screen reader if available
  </verify>
  <done>
    Admin panel accessible to all users
  </done>
</task>

<task type="auto">
  <name>Final end-to-end verification</name>
  <files>All admin panel files</files>
  <action>
    Comprehensive verification of all admin features:

    - ADMIN-01 Verification:
      1. Navigate to /admin/sources
      2. Verify documents list loads with status indicators
      3. Add new document (URL, PDF, text)
      4. Verify document appears in list
      5. Delete document and verify removal
      6. Trigger re-index and verify status change

    - ADMIN-02 Verification:
      1. Navigate to /admin/conversations
      2. Verify conversation list loads
      3. Search by keyword and verify filter
      4. Filter by date range
      5. Click conversation to view thread
      6. Verify messages display correctly
      7. Verify source citations

    - ADMIN-03 Verification:
      1. Navigate to /admin/settings
      2. Change primary color and verify preview updates
      3. Change position and verify preview updates
      4. Change welcome message and verify preview
      5. Save settings and verify success toast
      6. Refresh page and verify settings persist

    - ADMIN-04 Verification:
      1. Navigate to /admin/embed
      2. Verify API key displayed
      3. Test show/hide toggle
      4. Copy embed code to clipboard
      5. Verify embed script contains all data attributes
      6. Test regenerate key flow (if needed)

    - Overall Verification:
      1. Navigate through all sidebar links
      2. Test logout functionality
      3. Verify authentication required
      4. Test on mobile viewport
      5. Verify error states display correctly
    
    Document all test results for verification report.
  </action>
  <verify>
    - [ ] ADMIN-01: All source management operations work
    - [ ] ADMIN-02: All conversation features work
    - [ ] ADMIN-03: Widget customization saves and previews correctly
    - [ ] ADMIN-04: Embed code generates and copies correctly
    - [ ] All pages have loading and error states
    - [ ] Mobile responsive design works
    - [ ] Accessibility requirements met
  </verify>
  <done>
    All admin features verified and working
  </done>
</task>

</tasks>

<verification>
- [ ] Dashboard shows overview stats and quick actions
- [ ] All pages have skeleton loading states
- [ ] Errors display with alert components and error boundaries
- [ ] Mobile responsive design verified
- [ ] Toast notifications for success/error feedback
- [ ] Accessibility compliance checked
- [ ] ADMIN-01 fully functional
- [ ] ADMIN-02 fully functional
- [ ] ADMIN-03 fully functional
- [ ] ADMIN-04 fully functional
- [ ] Navigation works correctly between all sections
- [ ] Authentication required on all admin routes
</verification>

<success_criteria>
Admin panel complete and verified:
1. Dashboard provides overview and quick access ✅
2. All pages have consistent loading/error UX ✅
3. Mobile responsive design works ✅
4. All ADMIN requirements met ✅
   - ADMIN-01: Source management ✅
   - ADMIN-02: Conversation history ✅
   - ADMIN-03: Widget customization ✅
   - ADMIN-04: Embed code generation ✅
</success_criteria>

<output>
After completion, create `.planning/phases/03-admin-panel/03-06-SUMMARY.md` and `.planning/phases/03-admin-panel/03-FINAL-SUMMARY.md`
</output>
